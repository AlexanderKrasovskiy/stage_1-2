!function(){"use strict";const t=(t,e,s,a,i)=>{const n=document.createElement(t);return e&&(n.className=e),s&&(n.innerText=s),a&&(n.id=a),i&&n.setAttribute("disabled",""),n},e=e=>{const s=t("form","form"),a=`<input class="form__name" type="text" name="name" autocomplete="off" required ${e?"disabled":""}><input class="form__color" type="color" name="color" value="#ffffff" ${e?"disabled":""}><button class="btn${e?"":" btn-secondary"}" type="submit" ${e?"disabled":""}>${e?"UPDATE":"CREATE"}</button>`;return s.innerHTML=a,s},s=(t,e=50)=>`<svg style="fill:${t};width:${e}px" class="svg__img" xmlns="http://www.w3.org/2000/svg" shape-rendering="geometricPrecision" text-rendering="geometricPrecision" image-rendering="optimizeQuality" fill-rule="evenodd" clip-rule="evenodd" viewBox="0 0 512 375.5"><path d="M61.43 149.9v30.07h53.72V39.98H61.43V149.9zm287.95 164.55c-2.78 15.13-10.18 28.69-20.65 39.16-13.5 13.5-32.14 21.89-52.64 21.89H74.53c-20.51 0-39.15-8.39-52.65-21.89S0 321.48 0 300.97c0-11.6 2.68-22.6 7.46-32.42v-72.1c0-22.86 16.69-42 38.49-45.85V27.87H25.58V0h221.01l7.87 27.87h-18.52l12.94 88.06-6.19 33.97h50.35v-41.86c0-1.97 1.62-3.59 3.59-3.59h25.16c1.97 0 3.59 1.62 3.59 3.59v41.86h20.63c15.38 0 27.95 12.58 27.95 27.95v107.37h22.82V153.65c0-2.03 1.66-3.69 3.7-3.69h31.06C424.47 315.89 512 345.67 512 345.35v16.39c0 2.03-1.67 3.7-3.7 3.7H400.48a3.71 3.71 0 0 1-3.7-3.7v-47.29h-47.4zM70.94 283.43c9.35 0 16.93 7.58 16.93 16.93 0 9.36-7.58 16.94-16.93 16.94-9.36 0-16.94-7.58-16.94-16.94 0-9.35 7.58-16.93 16.94-16.93zm203.67 0c9.35 0 16.93 7.58 16.93 16.93 0 9.36-7.58 16.94-16.93 16.94-9.36 0-16.94-7.58-16.94-16.94 0-9.35 7.58-16.93 16.94-16.93zm-67.89 0c9.35 0 16.93 7.58 16.93 16.93 0 9.36-7.58 16.94-16.93 16.94-9.36 0-16.94-7.58-16.94-16.94 0-9.35 7.58-16.93 16.94-16.93zm-67.89 0c9.35 0 16.93 7.58 16.93 16.93 0 9.36-7.58 16.94-16.93 16.94-9.36 0-16.94-7.58-16.94-16.94 0-9.35 7.58-16.93 16.94-16.93zm137.26-43.57c33.61 0 61.11 27.5 61.11 61.11s-27.5 61.11-61.11 61.11H74.53c-33.61 0-61.11-27.5-61.11-61.11 0-32.64 26.61-61.11 61.11-61.11h201.56zm19.73-183.49c-1.44-1.48-.86-3.49 1.29-4.49 2.15-.99 5.06-.59 6.5.89 9.58 9.9 4.98 17.9.56 25.57-3.28 5.71-6.44 11.19-.67 16.64 1.53 1.44 1.08 3.47-1.01 4.52-2.09 1.06-5.03.75-6.56-.69-8.82-8.33-4.73-15.45-.46-22.85 3.52-6.13 7.2-12.52.35-19.59zm16.11 0c-1.44-1.48-.86-3.49 1.28-4.49 2.15-.99 5.06-.59 6.5.89 9.59 9.9 4.98 17.9.57 25.57-3.29 5.71-6.45 11.19-.68 16.64 1.54 1.44 1.08 3.47-1.01 4.52-2.08 1.06-5.02.75-6.55-.69-8.82-8.33-4.73-15.45-.47-22.85 3.53-6.13 7.21-12.52.36-19.59zM140.77 149.9v31.68h79.03l5.91-31.68 6.33-33.97-12.24-75.95h-79.03V149.9z"/></svg>`;class a{constructor(e){this.toGarageBtn=t("button","btn","TO GARAGE"),this.toWinnersBtn=t("button","btn btn-primary","TO WINNERS"),this.render(e)}render(e){const s=e,a=t("nav","nav");this.toGarageBtn.setAttribute("disabled",""),a.append(this.toGarageBtn,this.toWinnersBtn),s.append(a),document.body.append(s)}bindSwitchToGarage(t){this.toGarageBtn.addEventListener("click",(()=>{this.toGarageBtn.setAttribute("disabled",""),this.toGarageBtn.classList.remove("btn-primary"),t(),this.toWinnersBtn.removeAttribute("disabled"),this.toWinnersBtn.classList.add("btn-primary")}))}bindSwitchToWinners(t){this.toWinnersBtn.addEventListener("click",(()=>{this.toWinnersBtn.setAttribute("disabled",""),this.toWinnersBtn.classList.remove("btn-primary"),t(),this.toGarageBtn.removeAttribute("disabled"),this.toGarageBtn.classList.add("btn-primary")}))}}const i="http://127.0.0.1:3000",n=async t=>{try{const e=`${i}/garage`,s=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});return await s.json()}catch(t){return console.error(t),{id:0,name:"",color:""}}},r=(t,e,s,a,i)=>{1===e?(s.setAttribute("disabled",""),s.classList.remove("btn-primary")):(s.removeAttribute("disabled"),s.classList.add("btn-primary")),t<=i||e*i>=t?(a.setAttribute("disabled",""),a.classList.remove("btn-primary")):(a.removeAttribute("disabled"),a.classList.add("btn-primary"))};class o{constructor(s){this.findWinner=async(t,e)=>{const s=await Promise.race(t);if(!s.success){const a=e.findIndex((t=>t===s.id)),i=[...t.slice(0,a),...t.slice(a+1)],n=[...e.slice(0,a),...e.slice(a+1)];return this.findWinner(i,n)}return s},this.garageDiv=t("div","garage"),s.append(this.garageDiv),this.formCreate=e(!1),this.formUpdate=e(!0),this.raceStartBtn=t("button","btn btn-primary","RACE"),this.raceResetBtn=t("button","btn","RESET","",!0),this.generateCarsBtn=t("button","btn btn-secondary","GENERATE CARS"),this.carsCountHeading=t("h2"),this.garagePage=t("h3"),this.carsList=t("ul","cars__list"),this.prevPageBtn=t("button","btn","PREV","",!0),this.nextPageBtn=t("button","btn","NEXT","",!0),this.modalWinner=t("div","modal__winner hidden"),this.cars={},this.selectedCar=0,this.totalCars=0,this.currentPage=0,this.deleteCarByModel=()=>{},this.startEngineByModel=()=>Promise.resolve({velocity:1,distance:1}),this.driveByModel=()=>Promise.resolve({success:!0,code:200}),this.stopByModel=()=>Promise.resolve(!0),this.postWinnerByModel=()=>Promise.resolve(),this.initStartRaceListener(),this.initResetRaceListener()}initGarage({carsArr:e,count:s,page:a}){const i=t("div","garage__controls"),n=t("div","race__controls");n.append(this.raceStartBtn,this.raceResetBtn,this.generateCarsBtn),i.append(this.formCreate,this.formUpdate,n);const r=t("div","pagination");r.append(this.prevPageBtn,this.nextPageBtn),this.updateGarage({carsArr:e,count:s,page:a}),this.garageDiv.append(i,this.carsCountHeading,this.garagePage,this.carsList,r,this.modalWinner)}insertCarLi(e){const{name:a,color:i,id:n}=e,r=t("li","car__li"),o=t("button","btn btn-secondary","SELECT"),d=t("button","btn btn-secondary","REMOVE"),c=t("span","car__name",`${a}`),h=t("div");h.append(o,d,c);const l=t("button","btn__start btn__start-active","â–¶"),g=t("button","btn__stop","â– ","",!0),m=t("div","race__track");m.innerHTML=s(i);const b=m.lastChild,u=t("span","finish__flag","ðŸ");m.prepend(l,g,u),r.append(h,m),this.carsList.append(r);const p={id:n,name:a,color:i,selectBtn:o,deleteBtn:d,startBtn:l,stopBtn:g,svg:b,flag:u,animationID:0};this.cars[n]=p}bindCreateCar(t){this.formCreate.addEventListener("submit",(async e=>{e.preventDefault();const s=this.formCreate.elements,a=s.name.value;s.name.value="";const i=s.color.value;this.formCreate.setAttribute("disabled",""),await t({name:a,color:i}),this.formCreate.removeAttribute("disabled")}))}bindUpdateCar(t){this.formUpdate.addEventListener("submit",(async e=>{e.preventDefault();const s=this.formUpdate.elements,a=s.name.value,i=s.color.value,n=this.selectedCar;[...s].forEach((t=>{t.setAttribute("disabled",""),"BUTTON"===t.tagName&&t.classList.remove("btn-secondary")})),s.name.value="",await t({id:n,name:a,color:i})}))}bindGenerateRandomCars(t){this.generateCarsBtn.addEventListener("click",(async()=>{this.generateCarsBtn.setAttribute("disabled",""),this.generateCarsBtn.classList.remove("btn-secondary"),await t(),this.generateCarsBtn.removeAttribute("disabled"),this.generateCarsBtn.classList.add("btn-secondary")}))}updateGarage({carsArr:t,count:e,page:s}){this.totalCars=e,this.currentPage=s,this.carsCountHeading.innerText=`Garage (${e} cars)`,this.garagePage.innerText=`Page #${s}`,this.carsList.innerHTML="",this.cars={},t.forEach((t=>{this.insertCarLi(t),this.handleSelectCar(t.id),this.handleDeleteCar(t.id),this.handleStartEngine(t.id),this.handleStopEngine(t.id)})),r(e,s,this.prevPageBtn,this.nextPageBtn,7)}handleSelectCar(t){this.cars[t].selectBtn.addEventListener("click",(()=>{this.selectedCar=t;const e=this.formUpdate.elements;e.name.value=this.cars[t].name,e.color.value=this.cars[t].color,[...e].forEach((t=>{t.removeAttribute("disabled"),"BUTTON"===t.tagName&&t.classList.add("btn-secondary")})),e.name.focus()}))}bindDeleteCar(t){this.deleteCarByModel=t}handleDeleteCar(t){this.cars[t].deleteBtn.addEventListener("click",(async()=>{[...this.formUpdate.elements].forEach((t=>{t.setAttribute("disabled",""),"BUTTON"===t.tagName&&t.classList.remove("btn-secondary")})),await this.deleteCarByModel(t)}))}bindStartEngine(t){this.startEngineByModel=t}bindDriveCar(t){this.driveByModel=t}bindStopEngine(t){this.stopByModel=t}handleStartEngine(t){this.cars[t].startBtn.addEventListener("click",(async()=>{this.raceStartBtn.setAttribute("disabled",""),this.raceStartBtn.classList.remove("btn-primary"),this.disableControlsAndPagination(),await this.startEngine(t)}))}async startEngine(t){const{startBtn:e,stopBtn:s,selectBtn:a,deleteBtn:i}=this.cars[t];e.setAttribute("disabled",""),e.classList.remove("btn__start-active"),a.setAttribute("disabled",""),a.classList.remove("btn-secondary"),i.setAttribute("disabled",""),i.classList.remove("btn-secondary");const n=await this.startEngineByModel(t);(({distance:t,velocity:e},s)=>{const a=s,i=Math.round(t/e),n=(({svg:t,flag:e})=>{const s=t.getBoundingClientRect().x,a=e.getBoundingClientRect().right-s+5;return Math.round(a)})(a);let r=0;const{svg:o}=a,d=t=>{r||(r=t);const e=t-r,s=e/i*n;o.style.transform=`translateX(${s}px)`,e<i&&(a.animationID=window.requestAnimationFrame(d))};a.animationID=window.requestAnimationFrame(d)})(n,this.cars[t]),s.removeAttribute("disabled"),s.classList.add("btn__stop-active");const{code:r}=await this.driveByModel(t),o=Math.round(n.distance/n.velocity);return 500===r?(window.cancelAnimationFrame(this.cars[t].animationID),{success:!1,id:t,timeMs:o}):{success:!0,id:t,timeMs:o}}handleStopEngine(t){this.cars[t].stopBtn.addEventListener("click",(async()=>{this.raceStartBtn.removeAttribute("disabled"),this.raceStartBtn.classList.add("btn-primary"),await this.stopEngine(t),this.enableControlsAndPagination()}))}async stopEngine(t){const{stopBtn:e,startBtn:s,svg:a,selectBtn:i,deleteBtn:n}=this.cars[t];e.setAttribute("disabled",""),e.classList.remove("btn__stop-active"),i.removeAttribute("disabled"),i.classList.add("btn-secondary"),n.removeAttribute("disabled"),n.classList.add("btn-secondary"),await this.stopByModel(t),window.cancelAnimationFrame(this.cars[t].animationID),a.style.transform="translateX(0px)",s.removeAttribute("disabled"),s.classList.add("btn__start-active")}bindPostWinner(t){this.postWinnerByModel=t}initStartRaceListener(){this.raceStartBtn.addEventListener("click",(async()=>{this.raceStartBtn.setAttribute("disabled",""),this.raceStartBtn.classList.remove("btn-primary"),this.disableControlsAndPagination();const t=Object.values(this.cars),e=t.map((t=>this.startEngine(t.id))),s=t.map((t=>t.id)),{id:a,timeMs:i}=await this.findWinner(e,s);this.raceResetBtn.removeAttribute("disabled"),this.raceResetBtn.classList.add("btn-primary");const{name:n}=this.cars[a],r=(i/1e3).toFixed(2);this.modalWinner.innerText=`${n} went first [${r}s]!`,this.modalWinner.classList.remove("hidden"),await this.postWinnerByModel(a,i)}))}initResetRaceListener(){this.raceResetBtn.addEventListener("click",(async()=>{this.modalWinner.classList.add("hidden"),this.raceResetBtn.setAttribute("disabled",""),this.raceResetBtn.classList.remove("btn-primary");const t=Object.values(this.cars).map((t=>this.stopEngine(t.id)));await Promise.all(t),this.raceStartBtn.removeAttribute("disabled"),this.raceStartBtn.classList.add("btn-primary"),this.enableControlsAndPagination()}))}bindNextPage(t){this.nextPageBtn.addEventListener("click",(()=>{this.nextPageBtn.setAttribute("disabled",""),this.nextPageBtn.classList.remove("btn-primary"),t(1)}))}bindPrevPage(t){this.prevPageBtn.addEventListener("click",(()=>{this.prevPageBtn.setAttribute("disabled",""),this.prevPageBtn.classList.remove("btn-primary"),t(-1)}))}hideGarage(){this.garageDiv.classList.add("hidden")}showGarage(){this.garageDiv.classList.remove("hidden")}disableControlsAndPagination(){[...this.formCreate.elements].forEach((t=>{t.setAttribute("disabled",""),"BUTTON"===t.tagName&&t.classList.remove("btn-secondary")})),[...this.formUpdate.elements].forEach((t=>{t.setAttribute("disabled",""),"BUTTON"===t.tagName&&t.classList.remove("btn-secondary")})),this.generateCarsBtn.setAttribute("disabled",""),this.generateCarsBtn.classList.remove("btn-secondary"),this.prevPageBtn.setAttribute("disabled",""),this.prevPageBtn.classList.remove("btn-primary"),this.nextPageBtn.setAttribute("disabled",""),this.nextPageBtn.classList.remove("btn-primary")}enableControlsAndPagination(){[...this.formCreate.elements].forEach((t=>{t.removeAttribute("disabled"),"BUTTON"===t.tagName&&t.classList.add("btn-secondary")})),this.generateCarsBtn.removeAttribute("disabled"),this.generateCarsBtn.classList.add("btn-secondary"),r(this.totalCars,this.currentPage,this.prevPageBtn,this.nextPageBtn,7)}}const d=["Porsche","Hummer","Jeep","UAZ","Pontiac","Ford","Chevrolet","Lancia","Subaru","Pagani","McLaren","Ferrari","Shelby","Audi"],c=["911 turbo","Macan","Cayman","H1","Wrangler","Patriot","GTO","Mustang","GT40","Corvette","Delta Integrale","WRX STI","Zonda","F1","F-40","Cobra","Quattro"],h=()=>{const t="0123456789ABCDEF";return`#${Array(6).fill(1).map((()=>(()=>{const e=Math.floor(Math.random()*t.length);return t[e]})())).join("")}`};class l{constructor(t=1,e=[],s=0){this.carsPage=t,this.cars=e,this.carsCount=s,this.updateGarageView=()=>{}}async initGarage(t){await this.updateGarageState(),t({carsArr:this.cars,count:this.carsCount,page:this.carsPage})}async createCar(t){await n(t),await this.updateGarageState(),this.updateGarageView({carsArr:this.cars,count:this.carsCount,page:this.carsPage})}async generateRandomCars(t=100){const e=(t=>Array(t).fill(1).map((()=>({name:`${(()=>{const t=Math.floor(Math.random()*d.length);return d[t]})()} ${(()=>{const t=Math.floor(Math.random()*c.length);return c[t]})()}`,color:h()}))))(t);await Promise.all(e.map((t=>n(t)))),await this.updateGarageState(),this.updateGarageView({carsArr:this.cars,count:this.carsCount,page:this.carsPage})}async deleteCar(t){await(async t=>{try{const e=`${i}/garage/${t}`;return!!(await fetch(e,{method:"DELETE"})).ok}catch(t){return console.error(t),!1}})(t),await(async t=>{try{const e=`${i}/winners/${t}`;return!!(await fetch(e,{method:"DELETE"})).ok}catch(t){return console.error(t),!1}})(t);const e=this.carsPage-1;7*e==this.carsCount-1&&this.carsPage>1&&(this.carsPage=e),await this.updateGarageState(),this.updateGarageView({carsArr:this.cars,count:this.carsCount,page:this.carsPage})}async updateCar({id:t,name:e,color:s}){await(async(t,e)=>{try{const s=`${i}/garage/${t}`,a=await fetch(s,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});return await a.json()}catch(t){return console.error(t),{id:0,name:"",color:""}}})(t,{name:e,color:s}),await this.updateGarageState(),this.updateGarageView({carsArr:this.cars,count:this.carsCount,page:this.carsPage})}async startEngine(t){const e=await(async t=>{try{const e=`${i}/engine/?id=${t}&status=started`,s=await fetch(e,{method:"PATCH"});return await s.json()}catch(t){return console.error(t),{velocity:49,distance:5e5}}})(t);return e}async drive(t){const e=await(async t=>{try{const e=`${i}/engine/?id=${t}&status=drive`,s=await fetch(e,{method:"PATCH"});return 200===s.status?{success:!0,code:s.status}:{success:!1,code:s.status}}catch(t){return console.error(t),{success:!1,code:500}}})(t);return e}async stopEngine(t){const e=await(async t=>{try{const e=`${i}/engine/?id=${t}&status=stopped`;return!!(await fetch(e,{method:"PATCH"})).ok}catch(t){return console.error(t),!1}})(t);return e}async postWinner(t,e){const{winner:s,status:a}=await(async t=>{try{const e=`${i}/winners/${t}`,s=await fetch(e);return{winner:await s.json(),status:s.status}}catch(t){return console.error(t),{winner:{wins:0,time:100,id:0},status:404}}})(t);if(200===a){const a=s.wins+1,n=e/1e3<s.time?e/1e3:s.time;await(async({id:t,wins:e,time:s})=>{try{const a=`${i}/winners/${t}`,n=await fetch(a,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({wins:e,time:s})});return await n.json()}catch(t){return console.error(t),{wins:0,time:100,id:0}}})({id:t,wins:a,time:n})}else await(async t=>{try{const e=`${i}/winners`,s=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});return await s.json()}catch(t){return console.error(t),{wins:0,time:100,id:0}}})({id:t,wins:1,time:e/1e3})}async flipPage(t){this.carsPage+=t,await this.updateGarageState(),this.updateGarageView({carsArr:this.cars,count:this.carsCount,page:this.carsPage})}bindUpdateGarage(t){this.updateGarageView=t}async updateGarageState(){const{cars:t,total:e}=await(async(t=1,e=7)=>{try{const s=`${i}/garage/?_page=${t}&_limit=${e}`,a=await fetch(s);return{cars:await a.json(),total:Number(a.headers.get("X-Total-Count"))}}catch(t){return console.error(t),{cars:[],total:0}}})(this.carsPage);this.cars=t,this.carsCount=e}}class g{constructor(t){this.hide=()=>{this.view.hideGarage()},this.show=()=>{this.view.showGarage()},this.view=new o(t),this.model=new l,this.view.bindCreateCar(this.model.createCar.bind(this.model)),this.view.bindDeleteCar(this.model.deleteCar.bind(this.model)),this.view.bindUpdateCar(this.model.updateCar.bind(this.model)),this.view.bindNextPage(this.model.flipPage.bind(this.model)),this.view.bindPrevPage(this.model.flipPage.bind(this.model)),this.view.bindGenerateRandomCars(this.model.generateRandomCars.bind(this.model)),this.view.bindStartEngine(this.model.startEngine.bind(this.model)),this.view.bindDriveCar(this.model.drive.bind(this.model)),this.view.bindStopEngine(this.model.stopEngine.bind(this.model)),this.view.bindPostWinner(this.model.postWinner.bind(this.model)),this.model.bindUpdateGarage(this.view.updateGarage.bind(this.view)),this.model.initGarage(this.view.initGarage.bind(this.view))}}class m{constructor(e){this.winnersDiv=t("div","winners hidden"),e.append(this.winnersDiv),this.sortByModel=()=>{},this.flipPageByModel=()=>{}}renderWinners({winners:e,total:a,page:i,order:n,sortBy:o}){this.winnersDiv.innerHTML="";const d=t("h2","",`Winners (${a})`),c=t("h3","",`Page #${i}`),h=t("table"),l=this.getThead(n,o),g=((e,a)=>{const i=t("tbody");return e.forEach(((e,n)=>{const r=t("td","",`${n+1+10*(a-1)}`),o=t("td"),d=s(e.color,30);o.innerHTML=d;const c=t("td","",`${e.name}`),h=t("td","",`${e.wins}`),l=t("td","",`${e.time.toFixed(2)}s`),g=t("tr");g.append(r,o,c,h,l),i.append(g)})),i})(e,i);h.append(l,g);const m=t("div","pagination"),b=t("button","btn","PREV"),u=t("button","btn","NEXT");b.addEventListener("click",(()=>{this.flipPageByModel(-1)})),u.addEventListener("click",(()=>{this.flipPageByModel(1)})),r(a,i,b,u,10),m.append(b,u),this.winnersDiv.append(d,c,h,m)}bindHandleFlipPage(t){this.flipPageByModel=t}getThead(e,s){const a=t("thead","table__head"),i=t("tr"),n=t("th","","â„–"),r=t("th","","Car"),o=t("th","","Name");let d="";"wins"===s&&"ASC"===e&&(d=" â†‘"),"wins"===s&&"DESC"===e&&(d=" â†“");const c=t("th","pointer",`Wins${d}`);c.addEventListener("click",(()=>{this.sortByModel("wins")}));let h="";"time"===s&&"ASC"===e&&(h=" â†‘"),"time"===s&&"DESC"===e&&(h=" â†“");const l=t("th","pointer",`Best time${h}`);return l.addEventListener("click",(()=>{this.sortByModel("time")})),i.append(n,r,o,c,l),a.append(i),a}bindHandleSort(t){this.sortByModel=t}showWinners(){this.winnersDiv.classList.remove("hidden")}hideWinners(){this.winnersDiv.classList.add("hidden")}}class b{constructor(t=1,e,s,a=[],i=0){this.winnersPage=t,this.sortBy=e,this.order=s,this.winners=a,this.winnersCount=i}async getWinners(){return await this.updateWinnersState(),{winners:this.winners,total:this.winnersCount,page:this.winnersPage,order:this.order,sortBy:this.sortBy}}setSort(t){this.sortBy=t,this.order="ASC"===this.order?"DESC":"ASC"}flipPage(t){this.winnersPage+=t}async updateWinnersState(){const{winners:t,total:e}=await(async({page:t,limit:e=10,sortBy:s,order:a})=>{try{let n=`${i}/winners/?_page=${t}&_limit=${e}`;s&&a&&(n+=`&_sort=${s}&_order=${a}`);const r=await fetch(n),o=await r.json(),d=Number(r.headers.get("X-Total-Count")),c=o.map((async t=>{const e=await(async t=>{try{const e=`${i}/garage/${t}`,s=await fetch(e);return await s.json()}catch(t){return console.error(t),{id:0,name:"",color:""}}})(t.id);return{...t,...e}}));return{winners:await Promise.all(c),total:d}}catch(t){return console.error(t),{winners:[],total:0}}})({page:this.winnersPage,sortBy:this.sortBy,order:this.order});this.winners=t,this.winnersCount=e}}class u{constructor(t){this.view=new m(t),this.model=new b,this.view.bindHandleSort(this.handleSort.bind(this)),this.view.bindHandleFlipPage(this.handleFlipPage.bind(this))}async handleSort(t){this.model.setSort(t);const e=await this.model.getWinners();this.view.renderWinners(e)}async handleFlipPage(t){this.model.flipPage(t);const e=await this.model.getWinners();this.view.renderWinners(e)}async show(){this.model.setSort(void 0);const t=await this.model.getWinners();this.view.renderWinners(t),this.view.showWinners()}hide(){this.view.hideWinners()}}(new class{constructor(){this.root=t("main"),this.appView=new a(this.root),this.garageController=new g(this.root),this.winnersController=new u(this.root)}switchToGarage(){this.winnersController.hide(),this.garageController.show()}switchToWinners(){this.garageController.hide(),this.winnersController.show()}start(){this.appView.bindSwitchToGarage(this.switchToGarage.bind(this)),this.appView.bindSwitchToWinners(this.switchToWinners.bind(this))}}).start()}();